# ITBAN2-Advanced-MySQL-Queries-with-JSON-Data
Set up 'e_commerce' MySQL DB, designed tables for products, orders, order details, and customers. Populated with sample data and documented queries for retrieving product info, orders, filtering, aggregates, JSON operations, and table joins. Included SQL dumps, queries, and screenshots on GitHub.

## *By H. Torlao Jr. & D. Dano Jr.*

### 1. Retrieve Product Information:
* Write a query to fetch the names and descriptions of all products.

```sql
SELECT name, description
FROM products;
```
![alt text](image-3.png)

* Extend the previous query to include specific attributes such as color, size, and 
price.
```sql
SELECT name, description,
       JSON_EXTRACT(attributes, '$.color') AS color,
       JSON_EXTRACT(attributes, '$.size') AS size,
       JSON_EXTRACT(attributes, '$.price') AS price,
JSON_EXTRACT(attributes, '$.brandName') AS brand
FROM products;
```
![alt text](image-4.png)

### 2. Query Orders and Order Details:
* Retrieve the details of all orders placed, including the order date, customer ID, 
product name, quantity, and price.
```sql
SELECT
    o.order_id,
    o.order_date,
    o.customer_id,
    p.name AS product_name,
    od.quantity,
    od.price
FROM
    orders o JOIN
    order_details od ON o.order_id = od.order_id
JOIN products p ON od.product_id = p.product_id;
```
![alt text](image-5.png)
* Calculate the total cost of each order.
```sql
SELECT
    o.order_id,
    SUM(od.quantity * od.price) AS total_cost
FROM
    orders o
JOIN
    order_details od ON o.order_id = od.order_id
GROUP BY
    o.order_id;
```
![alt text](image-6.png)

### 3. Filtering Products Based on Attributes:
* Write a query to find all products with a price greater than $50.
```sql
SELECT *
FROM products
WHERE JSON_EXTRACT(attributes, '$.price') > 50;
```
![alt text](image-7.png)

* Filter products by color and brand, and display their names and prices.

```sql
SELECT name, JSON_EXTRACT(attributes, '$.price') AS price
FROM products
WHERE JSON_EXTRACT(attributes, '$.color') = 'teal' 
AND JSON_EXTRACT(attributes, '$.brandName') = 'Stiedemann LLC';
```
![alt text](image-8.png)

### 4. Calculating Aggregate Data:
* Calculate the total sales revenue generated by each product.
```sql
SELECT 
    p.product_id,
    p.name AS product_name,
    SUM(od.quantity * od.price) AS total_revenue
FROM 
    products p
JOIN 
    order_details od ON p.product_id = od.product_id
GROUP BY 
    p.product_id, p.name;
```
![alt text](image-9.png)

* Determine the total quantity of each product ordered.
```sql
SELECT 
    p.product_id,
    p.name AS product_name,
    SUM(od.quantity) AS total_quantity
FROM 
    products p
JOIN 
    order_details od ON p.product_id = od.product_id
GROUP BY 
    p.product_id, p.name;
```
![alt text](image-10.png)

### 5. Advanced Filtering and Aggregation:
* Find the top 5 best-selling products based on total quantity sold.
```sql
SELECT
    p.product_id,
    p.name AS product_name,
    SUM(od.quantity) AS total_quantity_sold
FROM
    products p
JOIN
    order_details od ON p.product_id = od.product_id
GROUP BY
    p.product_id, p.name
ORDER BY
    total_quantity_sold DESC Limit 5;
```
![alt text](image-11.png)

* Identify the average price of products from a specific brand.
```sql
SELECT
    AVG(JSON_EXTRACT(attributes, '$.price')) AS average_price,
    JSON_EXTRACT(attributes, '$.brandName') AS brand
FROM
    products
WHERE
    JSON_EXTRACT(attributes, '$.brandName') = 'Bayer - Harvey'
GROUP BY
    JSON_EXTRACT(attributes, '$.brandName');
```
![alt text](image-12.png)

### 6. Nested JSON Queries:
* Retrieve the color and size of a specific product.
```sql
SELECT
    JSON_EXTRACT(attributes, '$.color') AS color,
    JSON_EXTRACT(attributes, '$.size') AS size
FROM
    products
WHERE
    product_id = 1234;
```
![alt text](image-13.png)

* Extract and display all available attributes of products in JSON format.
```sql
SELECT JSON_OBJECT(
    'product_id', product_id,
    'name', name,
    'description', description,
    'attributes', attributes
) AS product_info
FROM products;
```
![alt text](image-14.png)

### 7. Joining Multiple Tables:
* Write a query to find all orders placed by customers along with the products 
ordered and their quantities.
```sql
SELECT 
    o.order_id,
    o.order_date,
    c.customer_id,
    p.name AS product_name,
    od.quantity
FROM 
    orders o
JOIN 
    order_details od ON o.order_id = od.order_id
JOIN 
    products p ON od.product_id = p.product_id
JOIN 
    customers c ON o.customer_id = c.customer_id;
```
![alt text](image-15.png)

* Calculate the total revenue generated by each customer.
```sql
SELECT
    CONCAT(c.firstname, ' ', COALESCE(c.middlename, ''), ' ', c.lastname) AS full_name,
    c.customer_id,
    SUM(od.quantity * JSON_EXTRACT(p.attributes, '$.price')) AS total_revenue
FROM
    customers c
JOIN
    orders o ON c.customer_id = o.customer_id
JOIN
    order_details od ON o.order_id = od.order_id
JOIN
    products p ON od.product_id = p.product_id
GROUP BY
    c.customer_id, full_name;
```
![alt text](image-16.png)

### 8. Data Manipulation with JSON Functions: 
* Update the price of a specific product stored as JSON attribute.
  
**_The original price of the product id 1234._**
```sql
SELECT product_id,
       JSON_EXTRACT(attributes, '$.price') AS price
FROM products
WHERE product_id=1234;
```
![alt text](image-17.png)

**_The query to update the specific price of the product id 1234._**
```sql
UPDATE products
SET attributes = JSON_SET(attributes, '$.price', 800.00)
WHERE product_id = 1234;
```
![alt text](image-18.png)

**_Updated Price of the product id number 1234._**
```sql
SELECT product_id,
       JSON_EXTRACT(attributes, '$.price') AS price
FROM products
WHERE product_id=1234;
```
![alt text](image-19.png)

* Add a new attribute to all products with a default value.
```sql
ALTER TABLE products ADD COLUMN weight VARCHAR(255) DEFAULT 'default_value';
```
![alt text](image-20.png)
**_This is the product attributes with newly added weight attribute._**
```sql
SELECT name, description,
       JSON_EXTRACT(attributes, '$.color') AS color,
       JSON_EXTRACT(attributes, '$.size') AS size,
       JSON_EXTRACT(attributes, '$.price') AS price,
 JSON_EXTRACT(attributes, '$.brandName') AS brand,
       JSON_EXTRACT(attributes, '$.weight') AS weight
FROM products;
```
![alt text](image-21.png)

### 9. Advanced JSON Operations: 
* Find products with specific attributes that match a given criteria using JSON path 
expressions.
```sql
SELECT *
FROM products
WHERE JSON_EXTRACT(attributes, '$.color') = 'blue'
  AND JSON_EXTRACT(attributes, '$.size') = 'medium';
```
![alt text](image-22.png)

* Extract and display the first element of an array stored within a JSON attribute.
```sql
SELECT JSON_UNQUOTE(JSON_EXTRACT(attributes,'$.color')) 
AS first_element FROM `products`;
```
![alt text](image-23.png)

## END

Thank you for visiting our repository! We hope you find the information provided here useful. If you have any questions or feedback, feel free to reach out to us. Don't forget to check out our other projects and contributions. Happy coding!
